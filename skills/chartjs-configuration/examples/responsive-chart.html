<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsive Chart.js Example</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      margin: 0;
    }

    h2 {
      margin-top: 40px;
    }

    /* IMPORTANT: Container must be relatively positioned and dedicated to chart only */
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    /* For viewport-based sizing */
    .chart-container-viewport {
      position: relative;
      height: 40vh;
      width: 80vw;
      max-width: 800px;
      margin: 0 auto;
    }

    /* Flexbox layout example */
    .flex-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .flex-container .chart-container {
      flex: 1;
      min-width: 0; /* CRITICAL: Prevents overflow in flexbox */
      min-height: 300px;
    }

    /* Grid layout example */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .grid-container .chart-container {
      min-width: 0; /* CRITICAL: Prevents overflow in grid */
      min-height: 300px;
    }

    /* Print styles */
    @media print {
      .chart-container {
        page-break-inside: avoid;
      }
    }

    .controls {
      margin: 20px 0;
    }

    button {
      padding: 8px 16px;
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Responsive Chart.js Examples</h1>

  <!-- Basic Responsive Chart -->
  <h2>1. Basic Responsive Chart</h2>
  <p>Container is relatively positioned with percentage width. Chart resizes automatically.</p>
  <div class="chart-container">
    <canvas id="basicChart"></canvas>
  </div>

  <!-- Viewport-Based Sizing -->
  <h2>2. Viewport-Based Sizing</h2>
  <p>Container uses viewport units (40vh x 80vw). Note: Set dimensions on container, not canvas.</p>
  <div class="chart-container-viewport">
    <canvas id="viewportChart"></canvas>
  </div>

  <!-- Flexbox Layout -->
  <h2>3. Flexbox Layout</h2>
  <p>Multiple charts in flexbox. Note <code>min-width: 0</code> on containers to prevent overflow.</p>
  <div class="flex-container">
    <div class="chart-container">
      <canvas id="flexChart1"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="flexChart2"></canvas>
    </div>
  </div>

  <!-- Grid Layout -->
  <h2>4. CSS Grid Layout</h2>
  <p>Multiple charts in CSS Grid. Same <code>min-width: 0</code> requirement applies.</p>
  <div class="grid-container">
    <div class="chart-container">
      <canvas id="gridChart1"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="gridChart2"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="gridChart3"></canvas>
    </div>
  </div>

  <!-- Print Handling -->
  <h2>5. Print-Ready Chart</h2>
  <p>Chart handles print media correctly. Try printing this page.</p>
  <div class="chart-container">
    <canvas id="printChart"></canvas>
  </div>

  <div class="controls">
    <button onclick="window.print()">Print Page</button>
    <button onclick="resizeContainer()">Toggle Container Size</button>
  </div>

  <script>
    // Sample data
    const labels = ['January', 'February', 'March', 'April', 'May', 'June'];
    const data = {
      labels: labels,
      datasets: [{
        label: 'Sales 2024',
        data: [65, 59, 80, 81, 56, 55],
        borderColor: 'rgb(75, 192, 192)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        fill: true,
        tension: 0.4
      }]
    };

    // 1. Basic Responsive Chart
    const basicChart = new Chart(document.getElementById('basicChart'), {
      type: 'line',
      data: JSON.parse(JSON.stringify(data)),
      options: {
        responsive: true,           // Default: true
        maintainAspectRatio: true,  // Default: true
        aspectRatio: 2,             // Width/height ratio
        plugins: {
          title: {
            display: true,
            text: 'Basic Responsive Chart'
          }
        }
      }
    });

    // 2. Viewport-Based Chart (square aspect ratio)
    const viewportChart = new Chart(document.getElementById('viewportChart'), {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Revenue',
          data: [12, 19, 3, 5, 2, 3],
          backgroundColor: 'rgba(54, 162, 235, 0.5)',
          borderColor: 'rgb(54, 162, 235)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,  // Required when container has fixed height
        plugins: {
          title: {
            display: true,
            text: 'Viewport-Based Chart (maintainAspectRatio: false)'
          }
        }
      }
    });

    // 3. Flexbox Charts
    const flexChart1 = new Chart(document.getElementById('flexChart1'), {
      type: 'doughnut',
      data: {
        labels: ['Red', 'Blue', 'Yellow'],
        datasets: [{
          data: [300, 50, 100],
          backgroundColor: ['#ff6384', '#36a2eb', '#ffce56']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: 'Flex Chart 1' }
        }
      }
    });

    const flexChart2 = new Chart(document.getElementById('flexChart2'), {
      type: 'pie',
      data: {
        labels: ['Green', 'Purple', 'Orange'],
        datasets: [{
          data: [150, 200, 100],
          backgroundColor: ['#4bc0c0', '#9966ff', '#ff9f40']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: 'Flex Chart 2' }
        }
      }
    });

    // 4. Grid Charts
    ['gridChart1', 'gridChart2', 'gridChart3'].forEach((id, index) => {
      new Chart(document.getElementById(id), {
        type: 'bar',
        data: {
          labels: ['A', 'B', 'C', 'D'],
          datasets: [{
            label: `Dataset ${index + 1}`,
            data: [Math.random() * 100, Math.random() * 100, Math.random() * 100, Math.random() * 100],
            backgroundColor: `hsl(${index * 120}, 70%, 60%)`
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: true, text: `Grid Chart ${index + 1}` }
          }
        }
      });
    });

    // 5. Print-Ready Chart
    const printChart = new Chart(document.getElementById('printChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Print-Ready Data',
          data: [28, 48, 40, 19, 86, 27],
          borderColor: 'rgb(153, 102, 255)',
          backgroundColor: 'rgba(153, 102, 255, 0.2)',
          fill: true
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Print-Ready Chart'
          }
        }
      }
    });

    // Print handling for resizable charts
    window.addEventListener('beforeprint', () => {
      // Force specific size for printing
      printChart.resize(600, 300);
    });

    window.addEventListener('afterprint', () => {
      // Restore automatic sizing
      printChart.resize();
    });

    // Alternative: Resize all charts for printing
    function beforePrintHandler() {
      for (let id in Chart.instances) {
        Chart.instances[id].resize();
      }
    }

    // Demo: Toggle container size
    let isSmall = false;
    function resizeContainer() {
      const container = document.querySelector('.chart-container');
      if (isSmall) {
        container.style.maxWidth = '800px';
      } else {
        container.style.maxWidth = '400px';
      }
      isSmall = !isSmall;
    }

    // Programmatic resize example
    function programmaticResize() {
      // Resize by changing container
      const container = printChart.canvas.parentNode;
      container.style.width = '400px';
      container.style.height = '200px';

      // Note: maintainAspectRatio must be false for height to take effect
    }
  </script>
</body>
</html>
